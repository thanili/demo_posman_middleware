# Source API
### Overview
The Source API project simulates a small part of a POS management system, storing key information related to:

* **Transactions**: Receipt documents generated by transactions at company POS stations or web stores.
* **Customers**: Profiles of customers who perform transactions.

It provides authenticated access for third-party services to retrieve customer data and periodically posts receipt data to a middleware service. This middleware serves as an intermediary between the POS system and external services, which can request additional customer details for each posted receipt.

### API Endpoints
* **CustomerController**: Exposes endpoints for retrieving full customer details. Since receipts only contain limited customer information (customer ID), these endpoints allow third-party services to fetch more complete customer data.
* **UserController**: Handles user authentication by validating secret keys provided during login. Upon successful validation, it returns an access token along with user details.

### Security
The service uses a combination of API Key and Access Token authentication to ensure secure access by third-party services.

**ApiUser**: An entity representing authorized users who can access the service. Each user has an API key (secret key) and an access token, which has a defined validity period.

**Authentication Mechanism**: The authentication mechanism implemented is a combination of API Key & Access Token authentication
* **API Key Authentication**: External services authenticate by calling `/api/user/login` with their secret key. Upon validation, they receive an access token and user details.
* **Access Token Authentication**: Third-party services use the access token (sent in the request header) to access customer data via the `/api/customer/**` endpoints (by customer ID or retrieve all customers).

**SecurityConfiguration**: Defines the security rules for different API endpoints:
* `/api/customer/`: Requires access token authentication.
* `/api/user/`: No authentication required for login operations.

**ApiKeyAuthenticationFilter**: A custom filter that validates the access token in each request. It checks the token's validity and expiration, and if valid, sets the authentication object in the security context.

**AccessTokenHelper**: A utility class responsible for validating access tokens based on their creation time and predefined validity period.

### Receipt Data Transfer Service
This service manages the periodic posting of receipt data to the external middleware service. The middleware can request additional customer data for the receipts sent, ensuring that third-party services have access to comprehensive transaction details.